---
title: "Scraping and Analysis"
author: "Waleed Iftikhar and Sameer Swarup"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rvest)
library(tidyverse)
library(purrr)
library(survey)
library(forcats)
library(class)
library(readr)
library(tidyr)
```

*Scraping data from Wikipedia*
```{r}
wikiurl <- "https://en.wikipedia.org/wiki/Ronaldo%E2%80%93Messi_rivalry#Club_statistics"
```

```{r}
wikipage <- read_html(wikiurl)
```

*Creating a dataset of club goals*
```{r}
tables.html <- html_nodes(wikipage,"table")
clgls <- html_table(tables.html[[5]], fill = TRUE) %>% as_tibble()
```

*Creating a dataset of Messi Club Goals.*
```{r}
messiclgls <- clgls  %>%
  select(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12)%>%
  slice(3:22)
messiclgls <- messiclgls %>%
  rename(Club = "X1", Season = "X2", LeagueApps = "X3", LeagueGoals = "X4", CupApps = "X5", CupGoals = "X6",EuropeApps = "X7", EuropeGoals = "X8",OtherApps = "X9", OtherGoals = "X10",TotalApps = "X11", TotalGoals = "X12" )
messiclgls <- messiclgls%>%
  slice(-(1:3))%>%
  slice(-17)
```

*Creating a dataset of Ronaldo Club Goals*
```{r}
crisclgls <- clgls  %>%
  select(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12)%>%
  slice(23:47)
crisclgls <- crisclgls %>%
  rename(Club = "X1", Season = "X2", LeagueApps = "X3", LeagueGoals = "X4", CupApps = "X5", CupGoals = "X6",EuropeApps = "X7", EuropeGoals = "X8",OtherApps = "X9", OtherGoals = "X10",TotalApps = "X11", TotalGoals = "X12" )
crisclgls <- crisclgls%>%
  slice(-(1:3))%>%
  drop_na()
```

*Creating a dataset of international goals*
```{r}
intgls <- html_table(tables.html[[8]], fill = TRUE) %>% as_tibble()
```

*Creating a dataset of Messi International Goals.*
```{r}
messiintgls <- intgls  %>%
  select(X1,X2,X3,X4,X5,X6,X7,X8)%>%
  slice(3:19)
messiintgls <- messiintgls %>%
  rename(NationalTeam= "X1", Year = "X2", CompApps= "X3", CompGoals = "X4", FrndApps = "X5", FrndGoals = "X6",TotalApps = "X7", TotalGoals = "X8")
messiintgls <- messiintgls%>%
  slice(-(1:2))
```

*Creating a dataset of Ronaldo International Goals.*
```{r}
crisintgls <- intgls  %>%
  select(X1,X2,X3,X4,X5,X6,X7,X8)%>%
  slice(23:41)
crisintgls <- crisintgls %>%
  rename(NationalTeam= "X1", Year = "X2", CompApps= "X3", CompGoals = "X4", FrndApps = "X5", FrndGoals = "X6",TotalApps = "X7", TotalGoals = "X8")
crisintgls <- crisintgls%>%
  slice(-(1:2))
```

*Scraping data from MessivsRonaldo.net*
```{r}
urlCalendar <- "https://messivsronaldo.net/calendar-year-stats/"
pageCalendar <- read_html(urlCalendar)
```

*Getting all nodes of type unordered list (ul)*
```{r}
div.html <- html_nodes(pageCalendar, "ul")
```
*Getting all of messi's and ronaldo's stats from the ul parent nodes*
```{r}
messi <- html_nodes(pageCalendar, ".messi.stats")
ronaldo <- html_nodes(pageCalendar, ".ronaldo.stats")
```

*Making tibble out of messi stats*
```{r}
messiStats <- tibble(
  apps = messi %>% html_node(".apps") %>% html_text(),
  assists = messi %>% html_node(".assists") %>% html_text(),
  goals = messi %>% html_node(".goals .num") %>% html_text()
)
```

*Making tibble out of ronaldo stats*
```{r}
ronaldoStats <- tibble(
  apps = ronaldo %>% html_node(".apps") %>% html_text(),
  assists = ronaldo %>% html_node(".assists") %>% html_text(),
  goals = ronaldo %>% html_node(".goals .num") %>% html_text()
)
```

*Cleaning data from the messiStats dataframe*
```{r}
messiStatsparse <- messiStats %>%
  mutate(apps = parse_number(apps), assists = parse_number(assists), goals = parse_number(goals))%>%
  mutate(type = rep(c("Total", "Club", "Country"), nrow(messiStats)/3))
```

*Filtering Apps, Assists, and Goals based on Total, Club and Country*
```{r}
MTotals <- messiStatsparse%>%
  filter(type == "Total")
MClubs <- messiStatsparse%>%
  filter(type == "Club")
MCountries <- messiStatsparse%>%
  filter(type == "Country")
```

```{r}
MTotals <- MTotals %>%
  select(apps,assists,goals) %>%
  rename(MTotApps = "apps", MTotAssists = "assists", MTotGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, MTotApps, MTotAssists, MTotGoals)
```

```{r}
MClubs <- MClubs %>%
  select(apps,assists,goals) %>%
  rename(MClubApps = "apps", MClubAssists = "assists", MClubGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, MClubApps, MClubAssists, MClubGoals)
```

```{r}
MCountries <- MCountries %>%
  select(apps,assists,goals) %>%
  rename(MCoApps = "apps", MCoAssists = "assists", MCoGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, MCoApps, MCoAssists, MCoGoals)
```

```{r}
MessiPartial <- left_join(MTotals,MClubs, by = "Year")
MessiComplete <- left_join(MessiPartial, MCountries, by = "Year")
```

*Cleaning data from the ronaldoStats dataframe*
```{r}
ronaldoStatsparse <- ronaldoStats %>%
  mutate(apps = parse_number(apps), assists = parse_number(assists), goals = parse_number(goals))%>%
  mutate(type = rep(c("Total", "Club", "Country"), nrow(ronaldoStats)/3))
```

```{r}
RTotals <- ronaldoStatsparse%>%
  filter(type == "Total")
RClubs <- ronaldoStatsparse%>%
  filter(type == "Club")
RCountries <- ronaldoStatsparse%>%
  filter(type == "Country")
```

```{r}
RTotals <- RTotals %>%
  select(apps,assists,goals) %>%
  rename(RTotApps = "apps", RTotAssists = "assists", RTotGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, RTotApps, RTotAssists, RTotGoals)
```

```{r}
RClubs <- RClubs %>%
  select(apps,assists,goals) %>%
  rename(RClubApps = "apps", RClubAssists = "assists", RClubGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, RClubApps, RClubAssists, RClubGoals)
```

```{r}
RCountries <- RCountries %>%
  select(apps,assists,goals) %>%
  rename(RCoApps = "apps", RCoAssists = "assists", RCoGoals = "goals" )%>%
  mutate(Year = rep(2020:2002))%>%
  select(Year, RCoApps, RCoAssists, RCoGoals)
```

```{r}
RonaldoPartial <- left_join(RTotals,RClubs, by = "Year")
RonaldoComplete <- left_join(RonaldoPartial, RCountries, by = "Year")
```

*Joining the MessiComplete and RonaldoComplete Dataframes*
```{r}
StatsComplete <- inner_join(MessiComplete, RonaldoComplete, by = "Year")
```

*Datawrangling from Trophy_Comparison dataset*
```{r}
RonaldoTrophies <- Trophy_Comparison%>%
  filter(Player == "Ronaldo")
MessiTrophies <- Trophy_Comparison%>%
  filter(Player == "Messi")
```

```{r}
RonaldoTrophies1 <- RonaldoTrophies %>%
  select(Year, League, DomesticCup, EuropeanCup) %>%
  rename(RLeague = "League", RDomesticCup = "DomesticCup", REuropeanCup = "EuropeanCup")
MessiTrophies1 <- MessiTrophies %>%
  select(Year, League, DomesticCup, EuropeanCup) %>%
  rename(MLeague = "League", MDomesticCup = "DomesticCup", MEuropeanCup = "EuropeanCup")
```

```{r}
Trophies <- inner_join(MessiTrophies1, RonaldoTrophies1, by = "Year")
```

```{r}
WithoutAward <- inner_join(StatsComplete, Trophies, by = "Year")
```

```{r}
WithoutAwardFilter <- WithoutAward %>%
  filter(Year >= 2008 & Year != 2018)
```

```{r}
WithAward <- WithoutAwardFilter %>%
  mutate(BallonDor = c("Messi", "Ronaldo", "Ronaldo","Messi", "Ronaldo", "Ronaldo", "Messi", "Messi", "Messi", "Messi", "Ronaldo"))
```

